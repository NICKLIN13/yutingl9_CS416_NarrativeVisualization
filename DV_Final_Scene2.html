<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
        </script>

    <link href="css/global.css" rel="stylesheet">


    <title>CS416 Final Project</title>
    <style>
        .bar {
            fill: steelblue;
        }

        .bar:hover {
            fill: rgba(84, 161, 187, 0.538)
        }

        .axis-label {
            font: 12px sans-serif;
        }
    </style>
</head>

<body style="padding-top: 70px; padding-bottom: 50px;">
    <nav class="navbar navbar-light bg-light fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">CS416 - Final Project</a>
            <a class="navbar-brand" id="scene0" href="DV_Final_Scene1.html">Scene1</a>
            <a class="navbar-brand" id="scene1" href="DV_Final_Scene2.html">Scene2</a>
            <a class="navbar-brand" id="scene2" href="DV_Final_Scene3.html">Scene3</a>
            <a class="navbar-brand" id="scene3" href="DV_Final_Final.html">Final</a>

            <!-- <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item active">
                        <a class="nav-link" href="stem.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="second.html">Scene2</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="jumpoff.html">Scene3</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="final2.html">Final</a>
                    </li>
                </ul>
            </div> -->
        </div>
    </nav>

    <div class="container">
        <div class="header-with-border">
            <h1>Possible Factors Contributing to Low Fertility Rate in Taiwan</h1>
        </div>
        <div class="row">
            <div class="col-md-6">
                <h4 style="text-align: center;">Spouses in Marriages</h4>
                <div id="chart"></div>
            </div>
        </div>
    </div>

    <div id="tooltip" style="position: absolute; opacity: 0;"></div>

    <!-- 引入 D3.js 库 -->
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <script>
        // 设置图表的尺寸
        const margin = { top: 20, right: 110, bottom: 40, left: 80 };
        const width = 700 - margin.left - margin.right;
        const height = 400 - margin.top - margin.bottom;

        // 创建 SVG 元素
        const svg = d3.select("#chart")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        const tooltip = d3.select("#tooltip");

        // 从 CSV 文件加载数据
        d3.csv("/CSV_data/結婚對數.csv").then(data => {
            // 转换数据类型
            data.forEach(d => {
                d.value = +d.value;
            });

            // 设置 x 轴和 y 轴的范围
            const x = d3.scaleBand()
                .domain(data.map(d => d.name))
                .range([0, width])
                .padding(0.1);

            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.value)])
                .nice()
                .range([height, 0]);

            // 添加 x 轴
            svg.append("g")
                .attr("class", "x-axis")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x));


            // x 軸標籤
            svg.append("text")
                .attr("class", "axis-label")
                .attr("x", width / 2)
                .attr("y", height + margin.bottom)  // 增加與 y 轴的距離
                .attr("text-anchor", "middle")
                .text("Year");

            // 添加 y 轴
            svg.append("g")
                .attr("class", "y-axis")
                .call(d3.axisLeft(y));


            // y 軸標籤
            svg.append("text")
                .attr("class", "axis-label")
                .attr("x", -height / 2)
                .attr("y", -margin.left + 20)  // 增加與 y 轴的距離
                .attr("transform", "rotate(-90)")
                .attr("text-anchor", "middle")
                .text("Pairs");

            // 绘制柱状图
            svg.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", d => x(d.name))
                .attr("y", d => y(d.value))
                .attr("width", x.bandwidth())
                .attr("height", d => height - y(d.value))
                .on("mouseover", (event, d) => {
                    tooltip.transition().duration(200).style("opacity", .9);
                    tooltip.html(`Year: ${d.name}<br>Pairs: ${d.value}`)
                        .style("left", (event.pageX + 5) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mousemove", (event, d) => {
                    tooltip.style("left", (event.pageX + 5) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", () => {
                    tooltip.transition().duration(500).style("opacity", 0);
                });
        }).catch(error => {
            console.error('Error loading the CSV file:', error);
        });



        document.addEventListener("DOMContentLoaded", function () {
            // 檢查目前頁面的 URL
            const currentUrl = window.location.href;

            // 拿到所有navbar的連結
            const navLinks = document.querySelectorAll('.navbar-brand');

            // 遍歷navbar，找到當前的，並把他改成active的css
            navLinks.forEach(link => {
                if (currentUrl.includes(link.getAttribute('href'))) {
                    link.classList.add('active');
                }
            });
        });

    </script>

    <div class="container mt-4">
        <div class="accordion" id="accordionExample">
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingOne">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        About the Visualization, Scene 2
                    </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne"
                    data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <div class="panel" style="text-align: justify;">
                            <h3>Visualization Narrative</h3>
                            <p class="lead">This page forms the base of the Martini Glass narrative visualization
                                structure, where users are engaging with author-driven content. The Scene3 link in the
                                navigation bar will guide users to the "jumping off point." The final page features
                                reader-driven content, enabling users to interact with the data and form their own
                                conclusions.
                            </p>

                            <h3>User Interface Events</h3>
                            <p class="lead">The navigation buttons at the top represent the User Interface events.
                                User interacts by clicking on the menu items to navigate to various part of this
                                visualzation story.
                                The hover event allows proper positioning of the tooltip.
                            </p>
                            <h3>Annotations</h3>
                            <p class="lead">The annotation is represented by the legend on the top-right of the chart
                                and a tooltip when mouse is hovered over different bars in the chart.
                                The labels along the X and Y axis provide clear annotations for the
                                chart.
                            </p>
                            <h3>Triggers</h3>
                            <p class="lead">The mouse click event on the navigation bar triggers back and forward
                                navigation within this visualization presentation. The mouse hover (mouseover) event
                                activates the tooltip in the bar chart. When the mouse hovers over a bar, it changes the
                                opacity of the nearest bar. As the mouse moves from one bar to another, the opacity of
                                the previous bar reverts to its original state, while the new bar's opacity changes.
                            </p>
                            <h3>Parameters</h3>
                            <p class="lead">This section is hyperlinked to the next section. The name of the target
                                section is passed as an input parameter to the buttons and items in the navigation bar.
                                The charts in these scenes are rendered through D3.js library.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer text-center">
        <div class="container">
            <p class="text-muted"></p>
            <strong>Author <a href="https://www.linkedin.com/in/yuting-nick-lin/" target="_blank">YuTing
                    Lin</a></strong>
            <br>
            <p>©️All rights reserved</p>
        </div>
    </footer>

</body>

</html>