<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
        </script>

    <link href="css/global.css" rel="stylesheet">


    <title>CS416 Final Project</title>
    <style>
        .bar {
            fill: rgba(145, 119, 86, 0.867);
        }

        .bar:hover {
            fill: rgba(161, 133, 94, 0.653);
        }

        .bar_blue {
            fill: steelblue
        }

        .bar_blue:hover {
            fill: rgba(84, 161, 187, 0.538)
        }

        .bar_green {
            fill: rgba(11, 144, 11, 0.801);
        }

        .bar_green:hover {
            fill: rgba(5, 189, 5, 0.592);
        }

        .axis-label {
            font: 12px sans-serif;
        }
    </style>
</head>

<body style="padding-top: 70px; padding-bottom: 50px;">
    <nav class="navbar navbar-light bg-light fixed-top">
        <div class="container style=" padding-bottom: 10px;">
            <a class="navbar-brand" href="#">CS416 - Final Project</a>
            <a class="navbar-brand" id="scene0" href="DV_Final_Scene1.html">Scene1</a>
            <a class="navbar-brand" id="scene1" href="DV_Final_Scene2.html">Scene2</a>
            <a class="navbar-brand" id="scene2" href="DV_Final_Scene3.html">Scene3</a>
            <a class="navbar-brand" id="scene3" href="DV_Final_Final.html">Final</a>

            <!-- <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item active">
                        <a class="nav-link" href="stem.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="second.html">Scene2</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="jumpoff.html">Scene3</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="final2.html">Final</a>
                    </li>
                </ul>
            </div> -->
        </div>
    </nav>

    <div id="tooltip" style="position: absolute; opacity: 0;"></div>

    <div class="container">
        <div class="header-with-border">
            <h1>Possible Factors Contributing to Low Fertility Rate in Taiwan</h1>
        </div>
        <div class="row">
            <div class="col-md-6">
                <h4 style="text-align: center;">Individual Average Income (Annual)</h4>
                <div id="chart"></div>
            </div>
            <div class="col-md-6">
                <h4 style="text-align: center;">College Enrollment Rate</h4>
                <div id="chart2"></div>
                <p>雖然收入往上，但也因為高學歷的關係，更容易產生”不想被婚姻綁住，更不願意生小孩來降低生活品質“的這種想法</p>
            </div>
        </div>
    </div>

    <!-- 引入 D3.js 库 -->
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <script>
        // 设置图表的尺寸
        const margin = { top: 20, right: 110, bottom: 40, left: 70 };
        const width = 700 - margin.left - margin.right;
        const height = 400 - margin.top - margin.bottom;

        // 创建 SVG 元素
        const svg = d3.select("#chart")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        const tooltip = d3.select("#tooltip");

        // 从 CSV 文件加载数据
        d3.csv("/CSV_data/AverageIncome.csv").then(data => {
            // 转换数据类型
            data.forEach(d => {
                d.value = +d.value;
            });

            // 设置 x 轴和 y 轴的范围
            const x = d3.scaleBand()
                .domain(data.map(d => d.name))
                .range([0, width])
                .padding(0.1);

            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.value)])
                .nice()
                .range([height, 0]);

            // 添加 x 轴
            svg.append("g")
                .attr("class", "x-axis")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x));

            // x 軸標籤
            svg.append("text")
                .attr("class", "axis-label")
                .attr("x", width / 2)
                .attr("y", height + margin.bottom)  // 增加與 y 轴的距離
                .attr("text-anchor", "middle")
                .text("Year");

            // 添加 y 轴
            svg.append("g")
                .attr("class", "y-axis")
                .call(d3.axisLeft(y));

            // y 軸標籤
            svg.append("text")
                .attr("class", "axis-label")
                .attr("x", -height / 2)
                .attr("y", -margin.left + 10)  // 增加與 y 轴的距離
                .attr("transform", "rotate(-90)")
                .attr("text-anchor", "middle")
                .text("TWD");

            // 绘制柱状图
            svg.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar_blue")
                .attr("x", d => x(d.name))
                .attr("y", d => y(d.value))
                .attr("width", x.bandwidth())
                .attr("height", d => height - y(d.value))
                .on("mouseover", (event, d) => {
                    tooltip.transition().duration(200).style("opacity", .9);
                    tooltip.html(`Year: ${d.name}<br>TWD: ${d.value}`)
                        .style("left", (event.pageX + 5) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mousemove", (event, d) => {
                    tooltip.style("left", (event.pageX + 5) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", () => {
                    tooltip.transition().duration(500).style("opacity", 0);
                });
        }).catch(error => {
            console.error('Error loading the CSV file:', error);
        });


        // 第二張圖表
        const margin2 = { top: 20, right: 110, bottom: 40, left: 70 };
        const width2 = 700 - margin2.left - margin2.right;
        const height2 = 400 - margin2.top - margin2.bottom;

        const svg2 = d3.select("#chart2")
            .append("svg")
            .attr("width", width2 + margin2.left + margin2.right)
            .attr("height", height2 + margin2.top + margin2.bottom)
            .append("g")
            .attr("transform", `translate(${margin2.left},${margin2.top})`);

        const tooltip2 = d3.select("#tooltip");

        d3.csv("/CSV_data/高等教育升學率.csv").then(data => {
            data.forEach(d => {
                d.value = +d.value;
            });

            const x2 = d3.scaleBand()
                .domain(data.map(d => d.name))
                .range([0, width2])
                .padding(0.1);

            const y2 = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.value)])
                .nice()
                .range([height2, 0]);

            svg2.append("g")
                .attr("class", "x-axis")
                .attr("transform", `translate(0,${height2})`)
                .call(d3.axisBottom(x2));

            // x 軸標籤
            svg2.append("text")
                .attr("class", "axis-label")
                .attr("x", width2 / 2)
                .attr("y", height2 + margin2.bottom)
                .attr("text-anchor", "middle")
                .text("Year");

            svg2.append("g")
                .attr("class", "y-axis")
                .call(d3.axisLeft(y2));

            // y 軸標籤
            svg2.append("text")
                .attr("class", "axis-label")
                .attr("x", -height2 / 2)
                .attr("y", -margin2.left + 35)  // 增加與 y 轴的距離
                .attr("transform", "rotate(-90)")
                .attr("text-anchor", "middle")
                .text("Rate (%)");


            // 添加黑色虛線
            svg2.append("line")
                .attr("x1", 0)
                .attr("y1", y2(95))
                .attr("x2", width2)
                .attr("y2", y2(95))
                .attr("stroke", "black")
                .attr("stroke-width", 2)
                .attr("stroke-dasharray", "4");

            svg2.selectAll(".bar_bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar_blue")
                .attr("x", d => x2(d.name))
                .attr("y", d => y2(d.value))
                .attr("width", x2.bandwidth())
                .attr("height", d => height2 - y2(d.value))
                .attr("class", d => d.value > 95 ? "bar_green" : "bar")
                .on("mouseover", (event, d) => {
                    tooltip2.transition().duration(200).style("opacity", .9);
                    tooltip2.html(`Year: ${d.name}<br>Rate: ${d.value} %`)
                        .style("left", (event.pageX + 5) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mousemove", (event, d) => {
                    tooltip2.style("left", (event.pageX + 5) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", () => {
                    tooltip2.transition().duration(500).style("opacity", 0);
                });

            // 確保柱狀圖不會覆蓋掉虛線
            svg2.selectAll(".bar_blue").lower();

        }).catch(error => {
            console.error('Error loading the CSV file:', error);
        });

        // 添加圖例
        const legend = svg2.append("g")
            .attr("class", "legend")
            .attr("transform", `translate(${width2 + 8}, ${margin.top})`);

        // 綠色圖例
        legend.append("circle")
            .attr("cx", 10)
            .attr("cy", 10)
            .attr("r", 5)
            .attr("fill", "rgba(11, 144, 11, 0.801)");

        legend.append("text")
            .attr("x", 20)
            .attr("y", 10)
            .attr("dy", "0.35em")
            .text("Above 95%");

        // 棕色圖例
        legend.append("circle")
            .attr("cx", 10)
            .attr("cy", 30)
            .attr("r", 5)
            .attr("fill", "rgba(145, 119, 86, 0.867)");

        legend.append("text")
            .attr("x", 20)
            .attr("y", 30)
            .attr("dy", "0.35em")
            .text("Below 95%");



        // 提示目前的所在頁面
        document.addEventListener("DOMContentLoaded", function () {
            // 檢查目前頁面的 URL
            const currentUrl = window.location.href;

            // 拿到所有navbar的連結
            const navLinks = document.querySelectorAll('.navbar-brand');

            // 遍歷navbar，找到當前的，並把他改成active的css
            navLinks.forEach(link => {
                if (currentUrl.includes(link.getAttribute('href'))) {
                    link.classList.add('active');
                }
            });
        });

    </script>

    <div class="container mt-4">
        <div class="accordion" id="accordionExample">
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingOne">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        About the Visualization, Scene 1
                    </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne"
                    data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <div class="panel" style="text-align: justify;">
                            <h3>Visualization Narrative</h3>
                            <p class="lead">The project utilizes the Martini Glass narrative visualization structure.
                                Scene1 serves as the foundation, guiding users through author-driven content.
                                Following this, scene3 acts as a "jumping off point," directing users to the final page.
                                This final page emphasizes reader-driven content, enabling users to draw their own
                                conclusions.
                            </p>
                            <p class="lead">
                                At the bottom of each scene, there's an "About" section. Here,
                                users can find detailed information about the user interface events, triggers,
                                annotations, and parameters specific to that page.
                            </p>
                            <h3>User Interface Events</h3>
                            <p class="lead">The navigation bar activates user interface events. Users can click these
                                menu items to
                                move through different parts of the story. Additionally, hovering the mouse over
                                elements is another type of user interface event. This hover event helps position
                                tooltips correctly. As the mouse moves from one bar to another, the previous bar returns
                                to its original color while the new bar
                                changes color accordingly.
                            </p>
                            <h3>Annotations</h3>
                            <p class="lead">The annotations include a legend located at the top-right of the second
                                chart and a tooltip that appears when hovering over different bars in both charts. The
                                labels, along with the X and Y axes, offer further annotations.<br>
                                The dashed line in the chart highlights a specific indicator that readers can notice.
                            </p>
                            <h3>Triggers</h3>
                            <p class="lead">Mouse clicks serve as trigger events for navigation, while mouse hover
                                (mouseover) events trigger tooltips in the bar chart. The highlighted navigation bar
                                items offer visual cues to indicate user action triggers.
                            </p>
                            <p class="lead">
                                Users can expand the "About the Visualization" section by clicking on the downward arrow
                                icon. Once
                                expanded, the downward arrow icon changes to a upward arrow icon, which users can click
                                to collapse the section.
                            </p>
                            <h3>Parameters</h3>
                            <p class="lead">This section is hyperlinked to the next section. The name of the target
                                section is passed as an input parameter to the buttons and items in the navigation bar.
                                The charts in these scenes are rendered through D3.js library.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer text-center">
        <div class="container">
            <p class="text-muted"></p>
            <strong>Author <a href="https://www.linkedin.com/in/yuting-nick-lin/" target="_blank">YuTing
                    Lin</a></strong>
            <br>
            <p>©️All rights reserved</p>
        </div>
    </footer>


</body>

</html>