<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
        </script>

    <link href="css/global.css" rel="stylesheet">


    <title>CS416 Final Project</title>
    <style>
        .bar {
            fill: steelblue;
        }

        .bar:hover {
            fill: orange;
        }

        .axis-label {
            font: 12px sans-serif;
        }
    </style>
</head>

<body style="padding-top: 70px">
    <nav class="navbar navbar-light bg-light fixed-top">
        <div class="container style=" padding-bottom: 10px;">
            <a class="navbar-brand" href="#">CS416 - Final Project</a>
            <a class="navbar-brand" href="DV_Final_home.html">Scene0</a>
            <a class="navbar-brand" href="DV_Final_Scene1.html">Scene1</a>
            <a class="navbar-brand" href="DV_Final_Scene2.html">Scene2</a>
            <a class="navbar-brand" href="DV_Final_Scene3.html">Scene3</a>

            <!-- <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item active">
                        <a class="nav-link" href="stem.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="second.html">Scene2</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="jumpoff.html">Scene3</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="final2.html">Final</a>
                    </li>
                </ul>
            </div> -->
        </div>
    </nav>

    <div id="tooltip" style="position: absolute; opacity: 0;"></div>

    <div class="container">
        <div class="header-with-border">
            <h1>Income, Investment preferences and Birth rate in Taiwan</h1>
        </div>
        <div class="row">
            <div class="col-md-6">
                <h4 style="text-align: center;">Individual Average Income (Annual)</h4>
                <div id="chart"></div>
            </div>
            <div class="col-md-6">
                <h4 style="text-align: center;">高等教育升學率</h4>
                <div id="chart2"></div>
                <p>雖然收入往上，但也因為高學歷的關係，更容易產生”不想被婚姻綁住，更不願意生小孩來降低生活品質“的這種想法</p>
            </div>
        </div>
    </div>

    <!-- 引入 D3.js 库 -->
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <script>
        // 设置图表的尺寸
        const margin = { top: 20, right: 60, bottom: 40, left: 80 };
        const width = 700 - margin.left - margin.right;
        const height = 400 - margin.top - margin.bottom;

        // 创建 SVG 元素
        const svg = d3.select("#chart")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        const tooltip = d3.select("#tooltip");

        // 从 CSV 文件加载数据
        d3.csv("/CSV_data/AverageIncome.csv").then(data => {
            // 转换数据类型
            data.forEach(d => {
                d.value = +d.value;
            });

            // 设置 x 轴和 y 轴的范围
            const x = d3.scaleBand()
                .domain(data.map(d => d.name))
                .range([0, width])
                .padding(0.1);

            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.value)])
                .nice()
                .range([height, 0]);

            // 添加 x 轴
            svg.append("g")
                .attr("class", "x-axis")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x));

            // x 軸標籤
            svg.append("text")
                .attr("class", "axis-label")
                .attr("x", width / 2)
                .attr("y", height + margin.bottom)  // 增加與 y 轴的距離
                .attr("text-anchor", "middle")
                .text("Year");

            // 添加 y 轴
            svg.append("g")
                .attr("class", "y-axis")
                .call(d3.axisLeft(y));

            // y 軸標籤
            svg.append("text")
                .attr("class", "axis-label")
                .attr("x", -height / 2)
                .attr("y", -margin.left + 20)  // 增加與 y 轴的距離
                .attr("transform", "rotate(-90)")
                .attr("text-anchor", "middle")
                .text("TWD");

            // 绘制柱状图
            svg.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", d => x(d.name))
                .attr("y", d => y(d.value))
                .attr("width", x.bandwidth())
                .attr("height", d => height - y(d.value))
                .on("mouseover", (event, d) => {
                    tooltip.transition().duration(200).style("opacity", .9);
                    tooltip.html(`Year: ${d.name}<br>TWD: ${d.value}`)
                        .style("left", (event.pageX + 5) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mousemove", (event, d) => {
                    tooltip.style("left", (event.pageX + 5) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", () => {
                    tooltip.transition().duration(500).style("opacity", 0);
                });
        }).catch(error => {
            console.error('Error loading the CSV file:', error);
        });


        // 第二張圖表
        const margin2 = { top: 20, right: 30, bottom: 40, left: 90 };
        const width2 = 700 - margin2.left - margin2.right;
        const height2 = 400 - margin2.top - margin2.bottom;

        const svg2 = d3.select("#chart2")
            .append("svg")
            .attr("width", width2 + margin2.left + margin2.right)
            .attr("height", height2 + margin2.top + margin2.bottom)
            .append("g")
            .attr("transform", `translate(${margin2.left},${margin2.top})`);

        const tooltip2 = d3.select("#tooltip");

        d3.csv("/CSV_data/高等教育升學率.csv").then(data => {
            data.forEach(d => {
                d.value = +d.value;
            });

            const x2 = d3.scaleBand()
                .domain(data.map(d => d.name))
                .range([0, width2])
                .padding(0.1);

            const y2 = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.value)])
                .nice()
                .range([height2, 0]);

            svg2.append("g")
                .attr("class", "x-axis")
                .attr("transform", `translate(0,${height2})`)
                .call(d3.axisBottom(x2));

            // x 軸標籤
            svg2.append("text")
                .attr("class", "axis-label")
                .attr("x", width2 / 2)
                .attr("y", height2 + margin2.bottom)  // 增加與 y 轴的距離
                .attr("text-anchor", "middle")
                .text("Year");

            svg2.append("g")
                .attr("class", "y-axis")
                .call(d3.axisLeft(y2));

            // y 軸標籤
            svg2.append("text")
                .attr("class", "axis-label")
                .attr("x", -height2 / 2)
                .attr("y", -margin2.left + 45)  // 增加與 y 轴的距離
                .attr("transform", "rotate(-90)")
                .attr("text-anchor", "middle")
                .text("Rate (%)");

            svg2.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", d => x2(d.name))
                .attr("y", d => y2(d.value))
                .attr("width", x2.bandwidth())
                .attr("height", d => height2 - y2(d.value))
                .on("mouseover", (event, d) => {
                    tooltip2.transition().duration(200).style("opacity", .9);
                    tooltip2.html(`Year: ${d.name}<br>Rate: ${d.value} %`)
                        .style("left", (event.pageX + 5) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mousemove", (event, d) => {
                    tooltip2.style("left", (event.pageX + 5) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", () => {
                    tooltip2.transition().duration(500).style("opacity", 0);
                });
        }).catch(error => {
            console.error('Error loading the CSV file:', error);
        });

    </script>

    <div class="container mt-4">
        <div class="accordion" id="accordionExample">
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingOne">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        About the Visualization, Home Page
                    </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne"
                    data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <div class="panel">
                            <h3>Visualization Narrative</h3>
                            <p class="lead">The project utilizes the Martini Glass narrative visualization structure.
                                The Home page serves as the foundation, guiding users through author-driven content.
                                Following this, scene3 acts as a "jumping off point," directing users to the final page.
                                This final page emphasizes reader-driven content, enabling users to draw their own
                                conclusions.
                            </p>
                            <p class="lead">
                                At the bottom of each scene, there's an "About" section. Here,
                                users can find detailed information about the user interface events, triggers,
                                annotations, and parameters specific to that page.
                            </p>
                            <h3>User Interface Events</h3>
                            <p class="lead">The navigation bar and the Previous and Next buttons at the bottom of
                                the page activate user interface events. Users can click these buttons or menu items to
                                move through different parts of the story. Additionally, hovering the mouse over
                                elements is another type of user interface event. This hover event helps position
                                tooltips correctly. As the mouse moves from one bar to another, changes in the X and Y
                                positions cause the previous bar to return to its original color while the new bar
                                changes color accordingly.
                            </p>
                            <h3>Annotations  這部分還沒做</h3>
                            <p class="lead">The annotation is represented by the legend on the top-right of the chart
                                and a
                                tooltip when mouse is hovered over different bars in the chart.
                                The legend and labels along the X and Y axis provides additional annotations for the
                                chart.
                            </p>
                            <h3>Triggers</h3>
                            <p class="lead">Mouse clicks serve as trigger events for navigation, while mouse hover
                                (mouseover) events trigger tooltips in the bar chart. The highlighted navigation bar
                                items and the colored buttons with icons offer visual cues to indicate user action
                                triggers.
                            </p>
                            <p class="lead">
                                Users can expand the About the Visualization section by clicking on the + icon. Once
                                expanded, the downward arrow icon changes to a upward arrow icon, which users can click
                                to collapse the section.
                            </p>
                            <h3>Parameters</h3>
                            <p class="lead">This section is hyperlinked to the next one, with the name of the target
                                section passed as an input parameter to the buttons and navigation bar items.
                            </p>

                            <p class="lead">The charts in this and next two scenes are rendered through Vega library.
                                Vega
                                is a declarative language and entire chart including data is defined as a JSON object.
                                The data for the chart is passed as a JSON object to
                                Vega API function for rendering axis,bars and tooltips for the chart. The JSON object is
                                stored seperately in the <strong>overallpoverty.json</strong>
                                file under data folder.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer text-center">
        <div class="container">
            <p class="text-muted"></p>
            <strong>Author <a href="https://www.linkedin.com/in/yuting-nick-lin/" target="_blank">YuTing
                    Lin</a></strong>
            <br>
            <p>©️All rights reserved</p>
        </div>
    </footer>


</body>

</html>